!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=React},function(e,t,n){"use strict";n.r(t);var r,o=n(0),a=n.n(o),i=a.a.createElement("svg",{width:"1792",height:"1792",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M1472 992v480q0 26-19 45t-45 19h-384v-384h-256v384h-384q-26 0-45-19t-19-45v-480q0-1 .5-3t.5-3l575-474 575 474q1 2 1 6zm223-69l-62 74q-8 9-21 11h-3q-13 0-21-7l-692-577-692 577q-12 8-24 7-13-2-21-11l-62-74q-8-10-7-23.5t11-21.5l719-599q32-26 76-26t76 26l244 204v-195q0-14 9-23t23-9h192q14 0 23 9t9 23v408l219 182q10 8 11 21.5t-7 23.5z"})),c=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function c(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,c)}l((r=r.apply(e,t||[])).next())})},u=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},s=function(e){function t(t){var n=e.call(this,t)||this;return n.search=function(e){return l(n,void 0,void 0,function(){var t,n,r=this;return u(this,function(o){switch(o.label){case 0:return this.setState({searching:!0}),[4,this.props.doSearch(e)];case 1:return t=o.sent(),this.state.pendingSearch?(n=this.state.pendingSearch,this.setState({pendingSearch:null},function(){r.search(n)}),[2]):(this.setState({searching:!1,entities:t}),[2])}})})},n.onInputChange=function(e){return l(n,void 0,void 0,function(){var t;return u(this,function(n){switch(n.label){case 0:return(t=e.currentTarget.value).length<3?[2]:this.state.searching?(this.setState({pendingSearch:t}),[2]):[4,this.search(t)];case 1:return n.sent(),[2]}})})},n.state={entities:[],searching:!1,hoverIndex:-1,pendingSearch:null},n}return c(t,e),t.prototype.render=function(){var e=this;return a.a.createElement("div",{style:this.props.style},a.a.createElement(wp.components.BaseControl,{style:{width:"100%"},id:"search",label:this.props.inputLabel,help:this.props.inputHelp},a.a.createElement("input",{id:"search",style:{width:"100%"},onChange:this.onInputChange})),a.a.createElement("div",{style:{height:"300px",overflowY:"auto"}},this.state.searching?a.a.createElement(wp.components.Placeholder,{style:{height:"300px"}},a.a.createElement(wp.components.Spinner,null)):this.state.entities.map(function(t,n){return a.a.createElement("div",{onMouseOver:function(){return e.setState({hoverIndex:n})},onClick:function(){return e.props.onSelect(t)},style:{fontWeight:e.state.hoverIndex==n?"bold":"normal",cursor:"pointer",paddingTop:"5px",paddingBottom:"5px"},key:t.id},e.props.getDisplayName(t))})))},t}(a.a.Component),p=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=(wp.i18n.__,function(e){function t(t){return e.call(this,t)||this}return p(t,e),t.prototype.render=function(){var e=this;return this.props.open?a.a.createElement(wp.components.Modal,{style:{minWidth:"60%"},title:this.props.modalTitle,onRequestClose:function(){return e.props.onClose()}},a.a.createElement(s,{doSearch:this.props.doSearch,inputLabel:this.props.inputLabel,inputHelp:this.props.inputHelp,getDisplayName:this.props.getDisplayName,onSelect:function(t){return e.onSelect(t)},style:{width:"100%"}})):null},t.prototype.onSelect=function(e){this.props.onSelect(e)},t}(a.a.Component)),f=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function c(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,c)}l((r=r.apply(e,t||[])).next())})},d=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},v="https://api.palvelutietovaranto.suomi.fi/api",g="v10",y=function(){return function(){var e=this;this.findServiceChannel=function(t){return f(e,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,this.findServiceChannels([t])];case 1:return[2,e.sent()[0]||null]}})})},this.findServiceChannels=function(t){return f(e,void 0,void 0,function(){var e,n=this;return d(this,function(r){switch(r.label){case 0:return t&&0!=t.length?(e=t.filter(function(e){return!n.channelCache.has(e)})).length>0?[4,fetch(v+"/"+g+"/ServiceChannel/list?guids="+e.join(","),{credentials:"omit"})]:[3,3]:[2,[]];case 1:return[4,r.sent().json()];case 2:r.sent().forEach(function(e){return n.channelCache.set(e.id,e)}),r.label=3;case 3:return[2,t.map(function(e){return n.channelCache.get(e)})]}})})},this.channelCache=new Map}}(),m=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function c(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(i,c)}l((r=r.apply(e,t||[])).next())})},w=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},S=wp.i18n.__,C=function(e){function t(t){var n=e.call(this,t)||this;return n.ptv=new y,n.renderLanguageSelect=function(){var e=wp.components,t=e.SelectControl,r=e.Tooltip,o=S("Language","sptv"),i=S("Select language of displayed component","sptv"),c=[{value:"fi",label:S("Finnish","sptv")},{value:"sv",label:S("Swedish","sptv")},{value:"en",label:S("Enlish","sptv")}];return a.a.createElement("div",null,a.a.createElement(r,{text:i},a.a.createElement("label",null," ",o," ")),a.a.createElement(t,{value:n.props.language,onChange:function(e){return n.props.onLanguageChange(e)},options:c}))},n.renderComponentSelect=function(){var e=wp.components,t=e.SelectControl,r=e.Tooltip,o=S("Component","sptv"),i=S("Select displayed component","sptv"),c=sptv.serviceLocationServiceChannelBlock.components.map(function(e){return{value:e.slug,label:e.name}});return a.a.createElement("div",null,a.a.createElement(r,{text:i},a.a.createElement("label",null," ",o," ")),a.a.createElement(t,{value:n.props.component,onChange:function(e){return n.props.onComponentChange(e)},options:c}))},n.renderSearchModal=function(){return a.a.createElement(h,{modalTitle:S("Search Services Locations","sptv"),inputLabel:S("Search Services Locations","sptv"),inputHelp:S("Enter some text to search service locations","sptv"),open:n.state.searchOpen,getDisplayName:n.getSearchResultDisplayName,doSearch:n.doSearch,onSelect:n.onSearchModalSelect,onClose:n.onSearchModalClose})},n.doSearch=function(e){return b(n,void 0,void 0,function(){var t;return w(this,function(n){switch(n.label){case 0:return"fi","servicelocation","v10",[4,(0,wp.apiFetch)({path:"/sptv/search-service-channels?q="+e+"&type=servicelocation&lang=fi&ptv=v10"})];case 1:return t=n.sent(),[4,this.ptv.findServiceChannels(t)];case 2:return[2,n.sent()]}})})},n.getSearchResultDisplayName=function(e){return n.getLocalizedValue(e.serviceChannelNames,"fi","Name")},n.onSearchModalSelect=function(e){n.setState({searchOpen:!1}),n.props.onChannelIdChange(e.id)},n.onSearchModalClose=function(){n.setState({searchOpen:!1})},n.onChangeButtonClick=function(){n.setState({searchOpen:!0})},n.state={searchOpen:t.editing&&!t.channelId},n}return m(t,e),t.prototype.componentDidUpdate=function(e,t){},t.prototype.render=function(){var e=wp.editor.InspectorControls;return a.a.createElement(e,null,this.renderLanguageSelect(),this.renderComponentSelect(),this.renderChangeButton(),this.renderSearchModal())},t.prototype.renderChangeButton=function(){return a.a.createElement("div",null,a.a.createElement(wp.components.Button,{isPrimary:!0,onClick:this.onChangeButtonClick},S("Change service location","sptv")))},t.prototype.getLocalizedValue=function(e,t,n){if(!e||!e.length)return null;var r=e.filter(function(e){return(!n||e.type==n)&&e.value&&e.value.trim()});return r.sort(function(e,n){return e.language===t?-1:1}),r[0]?r[0].value:null},t}(a.a.Component),_=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=(wp.i18n.__,function(e){function t(t){var n=e.call(this,t)||this;return n.renderInspectorControls=function(){return a.a.createElement(C,{editing:n.props.editing,channelId:n.props.channelId,language:n.props.language,component:n.props.component,onComponentChange:n.props.onComponentChange,onLanguageChange:n.props.onLanguageChange,onChannelIdChange:n.props.onChannelIdChange})},n.renderPreview=function(){return a.a.createElement("div",null,a.a.createElement(wp.components.ServerSideRender,{block:"sptv/service-location-service-channel-block",attributes:{id:n.props.channelId,language:n.props.language,component:n.props.component}}))},n.state={version:0,searchOpen:!1},n}return _(t,e),t.prototype.render=function(){return a.a.createElement("div",null,this.renderPreview(),this.renderInspectorControls())},t}(a.a.Component)),x=wp.i18n.__;(0,wp.blocks.registerBlockType)("sptv/service-location-service-channel-block",{title:x("Service location service channel","sptv"),icon:i,category:"sptv",attributes:{id:{type:"string"},component:{type:"string"},language:{type:"string"}},edit:function(e){var t=e.isSelected,n=function(t){return e.attributes[t]},r=function(t,n){var r={};r[t]=n,e.setAttributes(r)};return a.a.createElement(E,{editing:t,channelId:n("id"),component:n("component"),language:n("language"),onComponentChange:function(e){r("component",e)},onLanguageChange:function(e){r("language",e)},onChannelIdChange:function(e){r("id",e)}})},save:function(){return null}})}]);