!function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=1)}([function(e,n){e.exports=React},function(e,n,t){"use strict";t.r(n);var r,o=t(0),a=t.n(o),i=a.a.createElement("svg",{width:"1792",height:"1792",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("path",{d:"M1472 992v480q0 26-19 45t-45 19h-384v-384h-256v384h-384q-26 0-45-19t-19-45v-480q0-1 .5-3t.5-3l575-474 575 474q1 2 1 6zm223-69l-62 74q-8 9-21 11h-3q-13 0-21-7l-692-577-692 577q-12 8-24 7-13-2-21-11l-62-74q-8-10-7-23.5t11-21.5l719-599q32-26 76-26t76 26l244 204v-195q0-14 9-23t23-9h192q14 0 23 9t9 23v408l219 182q10 8 11 21.5t-7 23.5z"})),c=(r=function(e,n){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)},function(e,n){function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),l=function(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function c(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(i,c)}l((r=r.apply(e,n||[])).next())})},u=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},s=function(e){function n(n){var t=e.call(this,n)||this;return t.search=function(e){return l(t,void 0,void 0,function(){var n,t,r=this;return u(this,function(o){switch(o.label){case 0:return this.setState({searching:!0}),[4,this.props.doSearch(e)];case 1:return n=o.sent(),this.state.pendingSearch?(t=this.state.pendingSearch,this.setState({pendingSearch:null},function(){r.search(t)}),[2]):(this.setState({searching:!1,entities:n}),[2])}})})},t.onInputChange=function(e){return l(t,void 0,void 0,function(){var n;return u(this,function(t){switch(t.label){case 0:return(n=e.currentTarget.value).length<3?[2]:this.state.searching?(this.setState({pendingSearch:n}),[2]):[4,this.search(n)];case 1:return t.sent(),[2]}})})},t.state={entities:[],searching:!1,hoverIndex:-1,pendingSearch:null},t}return c(n,e),n.prototype.render=function(){var e=this;return a.a.createElement("div",{style:this.props.style},a.a.createElement(wp.components.BaseControl,{style:{width:"100%"},id:"search",label:this.props.inputLabel,help:this.props.inputHelp},a.a.createElement("input",{id:"search",style:{width:"100%"},onChange:this.onInputChange})),a.a.createElement("div",{style:{height:"300px",overflowY:"auto"}},this.state.searching?a.a.createElement(wp.components.Placeholder,{style:{height:"300px"}},a.a.createElement(wp.components.Spinner,null)):this.state.entities.map(function(n,t){return a.a.createElement("div",{onMouseOver:function(){return e.setState({hoverIndex:t})},onClick:function(){return e.props.onSelect(n)},style:{fontWeight:e.state.hoverIndex==t?"bold":"normal",cursor:"pointer",paddingTop:"5px",paddingBottom:"5px"},key:n.id},e.props.getDisplayName(n))})))},n}(a.a.Component),p=function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),h=(wp.i18n.__,function(e){function n(n){return e.call(this,n)||this}return p(n,e),n.prototype.render=function(){var e=this;return this.props.open?a.a.createElement(wp.components.Modal,{style:{minWidth:"60%"},title:this.props.modalTitle,onRequestClose:function(){return e.props.onClose()}},a.a.createElement(s,{doSearch:this.props.doSearch,inputLabel:this.props.inputLabel,inputHelp:this.props.inputHelp,getDisplayName:this.props.getDisplayName,onSelect:function(n){return e.onSelect(n)},style:{width:"100%"}})):null},n.prototype.onSelect=function(e){this.props.onSelect(e)},n}(a.a.Component)),f=function(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function c(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(i,c)}l((r=r.apply(e,n||[])).next())})},v=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},d="https://api.palvelutietovaranto.suomi.fi/api",g="v10",y=function(){return function(){var e=this;this.findServiceChannel=function(n){return f(e,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this.findServiceChannels([n])];case 1:return[2,e.sent()[0]||null]}})})},this.findServiceChannels=function(n){return f(e,void 0,void 0,function(){var e,t=this;return v(this,function(r){switch(r.label){case 0:return n&&0!=n.length?(e=n.filter(function(e){return!t.channelCache.has(e)})).length>0?[4,fetch(d+"/"+g+"/ServiceChannel/list?guids="+e.join(","),{credentials:"omit"})]:[3,3]:[2,[]];case 1:return[4,r.sent().json()];case 2:r.sent().forEach(function(e){return t.channelCache.set(e.id,e)}),r.label=3;case 3:return[2,n.map(function(e){return t.channelCache.get(e)})]}})})},this.channelCache=new Map}}(),m=function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),b=function(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function c(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(i,c)}l((r=r.apply(e,n||[])).next())})},w=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},S=wp.i18n.__,C=function(e){function n(n){var t=e.call(this,n)||this;return t.ptv=new y,t.renderLanguageSelect=function(){var e=wp.components,n=e.SelectControl,r=e.Tooltip,o=S("Language","sptv"),i=S("Select language of displayed component","sptv"),c=[{value:"fi",label:S("Finnish","sptv")},{value:"sv",label:S("Swedish","sptv")},{value:"en",label:S("Enlish","sptv")}];return a.a.createElement("div",null,a.a.createElement(r,{text:i},a.a.createElement("label",null," ",o," ")),a.a.createElement(n,{value:t.props.language,onChange:function(e){return t.props.onLanguageChange(e)},options:c}))},t.renderComponentSelect=function(){var e=wp.components,n=e.SelectControl,r=e.Tooltip,o=S("Component","sptv"),i=S("Select displayed component","sptv"),c=sptv.serviceLocationServiceChannelBlock.components.map(function(e){return{value:e.slug,label:e.name}});return a.a.createElement("div",null,a.a.createElement(r,{text:i},a.a.createElement("label",null," ",o," ")),a.a.createElement(n,{value:t.props.component,onChange:function(e){return t.props.onComponentChange(e)},options:c}))},t.renderSearchModal=function(){return a.a.createElement(h,{modalTitle:S("Search Services Locations","sptv"),inputLabel:S("Search Services Locations","sptv"),inputHelp:S("Enter some text to search service locations","sptv"),open:t.state.searchOpen,getDisplayName:t.getSearchResultDisplayName,doSearch:t.doSearch,onSelect:t.onSearchModalSelect,onClose:t.onSearchModalClose})},t.doSearch=function(e){return b(t,void 0,void 0,function(){var n,t;return w(this,function(r){switch(r.label){case 0:return"fi","servicelocation","v10",[4,(0,wp.apiFetch)({path:"/sptv/search-service-channels?q="+e+"&type=servicelocation&lang=fi&ptv=v10"})];case 1:return n=r.sent(),[4,this.ptv.findServiceChannels(n)];case 2:return t=r.sent(),[2,t.filter(function(e){return void 0!==e})]}})})},t.getSearchResultDisplayName=function(e){return t.getLocalizedValue(e.serviceChannelNames,"fi","Name")},t.onSearchModalSelect=function(e){t.setState({searchOpen:!1}),t.props.onChannelIdChange(e.id)},t.onSearchModalClose=function(){t.setState({searchOpen:!1})},t.onChangeButtonClick=function(){t.setState({searchOpen:!0})},t.state={searchOpen:n.editing&&!n.channelId},t}return m(n,e),n.prototype.componentDidUpdate=function(e,n){},n.prototype.render=function(){var e=wp.editor.InspectorControls;return a.a.createElement(e,null,this.renderLanguageSelect(),this.renderComponentSelect(),this.renderChangeButton(),this.renderSearchModal())},n.prototype.renderChangeButton=function(){return a.a.createElement("div",null,a.a.createElement(wp.components.Button,{isPrimary:!0,onClick:this.onChangeButtonClick},S("Change service location","sptv")))},n.prototype.getLocalizedValue=function(e,n,t){if(!e||!e.length)return null;var r=e.filter(function(e){return(!t||e.type==t)&&e.value&&e.value.trim()});return r.sort(function(e,t){return e.language===n?-1:1}),r[0]?r[0].value:null},n}(a.a.Component),_=function(){var e=function(n,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(n,t)};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),E=(wp.i18n.__,function(e){function n(n){var t=e.call(this,n)||this;return t.renderInspectorControls=function(){return a.a.createElement(C,{editing:t.props.editing,channelId:t.props.channelId,language:t.props.language,component:t.props.component,onComponentChange:t.props.onComponentChange,onLanguageChange:t.props.onLanguageChange,onChannelIdChange:t.props.onChannelIdChange})},t.renderPreview=function(){return a.a.createElement("div",null,a.a.createElement(wp.components.ServerSideRender,{block:"sptv/service-location-service-channel-block",attributes:{id:t.props.channelId,language:t.props.language,component:t.props.component}}))},t.state={},t}return _(n,e),n.prototype.render=function(){return a.a.createElement("div",null,this.renderPreview(),this.renderInspectorControls())},n}(a.a.Component)),x=wp.i18n.__;(0,wp.blocks.registerBlockType)("sptv/service-location-service-channel-block",{title:x("Service location service channel","sptv"),icon:i,category:"sptv",attributes:{id:{type:"string"},component:{type:"string"},language:{type:"string"}},edit:function(e){var n=e.isSelected,t=function(n){return e.attributes[n]},r=function(n,t){var r={};r[n]=t,e.setAttributes(r)};return t("component")||r("component",sptv.serviceLocationServiceChannelBlock.components?sptv.serviceLocationServiceChannelBlock.components[0].slug:null),t("language")||r("language","fi"),a.a.createElement(E,{editing:n,channelId:t("id"),component:t("component"),language:t("language"),onComponentChange:function(e){r("component",e)},onLanguageChange:function(e){r("language",e)},onChannelIdChange:function(e){r("id",e)}})},save:function(){return null}})}]);